<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿œç”¨æƒ…å ±æŠ€è¡“è€…è©¦é¨“ å­¦ç¿’è¨ˆç”»</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        h2 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #333;
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .metric-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #667eea;
        }
        
        .metric-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .metric-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background-color: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #5a6fd8;
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c82333;
        }
        
        .btn-small {
            padding: 4px 12px;
            font-size: 12px;
        }
        
        .priority-high {
            background-color: #fee;
            color: #c53030;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .priority-medium {
            background-color: #fffbeb;
            color: #d69e2e;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .priority-low {
            background-color: #f0fff4;
            color: #38a169;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .status-completed {
            background-color: #d4edda;
            color: #155724;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .status-studying {
            background-color: #d1ecf1;
            color: #0c5460;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .status-pending {
            background-color: #f8f9fa;
            color: #6c757d;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
        
        .subject-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .subject-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        
        .timer-display {
            background: #2d3748;
            color: #4fd1c7;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            margin-top: 4px;
            text-align: center;
            min-width: 80px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .metrics {
                grid-template-columns: repeat(2, 1fr);
            }
            
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 8px 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="card">
            <h1>ğŸ“š å¿œç”¨æƒ…å ±æŠ€è¡“è€…è©¦é¨“ å­¦ç¿’è¨ˆç”»</h1>
            <p>å­¦ç¿’çµ‚äº†: <strong>2024å¹´10æœˆ5æ—¥</strong> | è©¦é¨“æ—¥: <strong>2024å¹´10æœˆ12æ—¥</strong></p>
            <div class="progress-bar">
                <div class="progress-fill" id="overall-progress" style="width: 12%"></div>
            </div>
            <p>å…¨ä½“é€²æ—: <span id="progress-text">12%</span></p>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç† -->
        <div class="card">
            <h2>ğŸ“Š ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
            <div class="button-group">
                <button class="btn btn-success" onclick="exportData()">ğŸ“¥ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                <label class="btn btn-primary" style="cursor: pointer;">
                    ğŸ“¤ ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                    <input type="file" accept=".json" onchange="importData(event)" style="display: none;">
                </label>
                <button class="btn btn-danger" onclick="if(confirm('ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')){localStorage.clear();location.reload();}">ğŸ—‘ï¸ ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
        </div>

        <!-- ã‚­ãƒ¼ãƒ¡ãƒˆãƒªã‚¯ã‚¹ -->
        <div class="card">
            <h2>ğŸ“ˆ å­¦ç¿’çŠ¶æ³</h2>
            <div class="metrics">
                <div class="metric-item">
                    <div class="metric-number" id="completed-count">2</div>
                    <div class="metric-label">å®Œäº†ç§‘ç›®æ•°</div>
                </div>
                <div class="metric-item">
                    <div class="metric-number" id="studying-count">1</div>
                    <div class="metric-label">å­¦ç¿’ä¸­ç§‘ç›®æ•°</div>
                </div>
                <div class="metric-item">
                    <div class="metric-number" id="high-priority-count">4</div>
                    <div class="metric-label">é«˜å„ªå…ˆåº¦ç§‘ç›®</div>
                </div>
                <div class="metric-item">
                    <div class="metric-number" id="remaining-days">72</div>
                    <div class="metric-label">æ®‹ã‚Šæ—¥æ•°</div>
                </div>
            </div>
        </div>

        <!-- å­¦ç¿’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« -->
        <div class="card">
            <h2>ğŸ“… å­¦ç¿’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h2>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>ç§‘ç›®</th>
                            <th>ãƒ•ã‚§ãƒ¼ã‚º</th>
                            <th>ã‚¿ã‚¤ãƒãƒ¼</th>
                            <th>é€²æ—æ™‚é–“</th>
                            <th>æ®‹ã‚Š/ç›®æ¨™æ™‚é–“</th>
                            <th>å„ªå…ˆåº¦</th>
                            <th>çŠ¶æ…‹ãƒ»æœŸé–“</th>
                        </tr>
                    </thead>
                    <tbody id="schedule-body">
                        <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ç§‘ç›®åˆ¥è©³ç´° -->
        <div class="card">
            <h2>ğŸ“š ç§‘ç›®åˆ¥å­¦ç¿’çŠ¶æ³</h2>
            <div class="subject-grid" id="subjects-grid">
                <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script>
        console.log('ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹');

        // å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ï¼ˆå­¦ç¿’æ™‚é–“ãƒ™ãƒ¼ã‚¹ã®æœŸé–“è¨­å®šï¼‰
        const initialData = {
            subjects: [
                { 
                    id: 1, 
                    name: "åŸºç¤ç†è«–", 
                    priority: "ä¸­", 
                    currentWeek: 3, 
                    status: "å®Œäº†", 
                    examWeight: 8, 
                    description: "æ•°å­¦ã€è«–ç†æ¼”ç®—ãªã©",
                    schedule: [
                        { phase: "1é€±ç›®:ã‚¤ãƒ³ãƒ—ãƒƒãƒˆ", start: "2024-07-25", end: "2024-07-28", hours: 4 },
                        { phase: "2é€±ç›®:å¾©ç¿’", start: "2024-07-29", end: "2024-07-30", hours: 3 },
                        { phase: "3é€±ç›®:åˆå¾Œå¯¾ç­–", start: "2024-07-31", end: "2024-08-02", hours: 5 }
                    ]
                },
                { 
                    id: 2, 
                    name: "ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¨ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°", 
                    priority: "é«˜", 
                    currentWeek: 1, 
                    status: "å­¦ç¿’ä¸­", 
                    examWeight: 12, 
                    description: "ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã€ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è¨­è¨ˆ",
                    schedule: [
                        { phase: "1é€±ç›®:ã‚¤ãƒ³ãƒ—ãƒƒãƒˆ", start: "2024-08-03", end: "2024-08-08", hours: 8 },
                        { phase: "2é€±ç›®:å¾©ç¿’", start: "2024-08-09", end: "2024-08-12", hours: 5 },
                        { phase: "3é€±ç›®:åˆå¾Œå¯¾ç­–", start: "2024-08-13", end: "2024-08-18", hours: 10 }
                    ]
                },
                { 
                    id: 3, 
                    name: "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹", 
                    priority: "é«˜", 
                    currentWeek: 0, 
                    status: "æœªé–‹å§‹", 
                    examWeight: 15, 
                    description: "é–¢ä¿‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€SQLã€æ­£è¦åŒ–",
                    schedule: [
                        { phase: "1é€±ç›®:ã‚¤ãƒ³ãƒ—ãƒƒãƒˆ", start: "2024-08-19", end: "2024-08-25", hours: 10 },
                        { phase: "2é€±ç›®:å¾©ç¿’", start: "2024-08-26", end: "2024-08-30", hours: 6 },
                        { phase: "3é€±ç›®:åˆå¾Œå¯¾ç­–", start: "2024-08-31", end: "2024-09-06", hours: 12 }
                    ]
                },
                { 
                    id: 4, 
                    name: "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯", 
                    priority: "é«˜", 
                    currentWeek: 0, 
                    status: "æœªé–‹å§‹", 
                    examWeight: 12, 
                    description: "TCP/IPã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€ãƒ—ãƒ­ãƒˆã‚³ãƒ«",
                    schedule: [
                        { phase: "1é€±ç›®:ã‚¤ãƒ³ãƒ—ãƒƒãƒˆ", start: "2024-09-07", end: "2024-09-11", hours: 8 },
                        { phase: "2é€±ç›®:å¾©ç¿’", start: "2024-09-12", end: "2024-09-15", hours: 5 },
                        { phase: "3é€±ç›®:åˆå¾Œå¯¾ç­–", start: "2024-09-16", end: "2024-09-21", hours: 10 }
                    ]
                },
                { 
                    id: 5, 
                    name: "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£", 
                    priority: "é«˜", 
                    currentWeek: 0, 
                    status: "æœªé–‹å§‹", 
                    examWeight: 15, 
                    description: "æš—å·åŒ–ã€èªè¨¼ã€æƒ…å ±ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–",
                    schedule: [
                        { phase: "1é€±ç›®:ã‚¤ãƒ³ãƒ—ãƒƒãƒˆ", start: "2024-09-22", end: "2024-09-26", hours: 10 },
                        { phase: "2é€±ç›®:å¾©ç¿’", start: "2024-09-27", end: "2024-09-30", hours: 6 },
                        { phase: "3é€±ç›®:åˆå¾Œå¯¾ç­–", start: "2024-10-01", end: "2024-10-05", hours: 12 }
                    ]
                },
                { 
                    id: 6, 
                    name: "ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã¨ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿æ§‹æˆè¦ç´ ", 
                    priority: "ä¸­", 
                    currentWeek: 0, 
                    status: "æœªé–‹å§‹", 
                    examWeight: 8, 
                    description: "CPUã€ãƒ¡ãƒ¢ãƒªã€å…¥å‡ºåŠ›è£…ç½®",
                    schedule: [
                        { phase: "1é€±ç›®:ã‚¤ãƒ³ãƒ—ãƒƒãƒˆ", start: "2024-08-19", end: "2024-08-21", hours: 4 },
                        { phase: "2é€±ç›®:å¾©ç¿’", start: "2024-08-22", end: "2024-08-23", hours: 3 },
                        { phase: "3é€±ç›®:åˆå¾Œå¯¾ç­–", start: "2024-08-24", end: "2024-08-26", hours: 5 }
                    ]
                },
                { 
                    id: 7, 
                    name: "ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢", 
                    priority: "ä¸­", 
                    currentWeek: 0, 
                    status: "æœªé–‹å§‹", 
                    examWeight: 8, 
                    description: "OSã€ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ",
                    schedule: [
                        { phase: "1é€±ç›®:ã‚¤ãƒ³ãƒ—ãƒƒãƒˆ", start: "2024-08-27", end: "2024-08-29", hours: 4 },
                        { phase: "2é€±ç›®:å¾©ç¿’", start: "2024-08-30", end: "2024-08-31", hours: 3 },
                        { phase: "3é€±ç›®:åˆå¾Œå¯¾ç­–", start: "2024-09-01", end: "2024-09-03", hours: 5 }
                    ]
                },
                { 
                    id: 8, 
                    name: "ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆè¦ç´ ", 
                    priority: "ä¸­", 
                    currentWeek: 0, 
                    status: "æœªé–‹å§‹", 
                    examWeight: 6, 
                    description: "ã‚·ã‚¹ãƒ†ãƒ æ€§èƒ½ã€å¯ç”¨æ€§",
                    schedule: [
                        { phase: "1é€±ç›®:ã‚¤ãƒ³ãƒ—ãƒƒãƒˆ", start: "2024-09-04", end: "2024-09-05", hours: 3 },
                        { phase: "2é€±ç›®:å¾©ç¿’", start: "2024-09-06", end: "2024-09-07", hours: 2 },
                        { phase: "3é€±ç›®:åˆå¾Œå¯¾ç­–", start: "2024-09-08", end: "2024-09-10", hours: 4 }
                    ]
                },
                { 
                    id: 9, 
                    name: "ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºæŠ€è¡“", 
                    priority: "ä¸­", 
                    currentWeek: 0, 
                    status: "æœªé–‹å§‹", 
                    examWeight: 8, 
                    description: "é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹ã€ãƒ†ã‚¹ãƒˆæ‰‹æ³•",
                    schedule: [
                        { phase: "1é€±ç›®:ã‚¤ãƒ³ãƒ—ãƒƒãƒˆ", start: "2024-09-11", end: "2024-09-13", hours: 4 },
                        { phase: "2é€±ç›®:å¾©ç¿’", start: "2024-09-14", end: "2024-09-15", hours: 3 },
                        { phase: "3é€±ç›®:åˆå¾Œå¯¾ç­–", start: "2024-09-16", end: "2024-09-18", hours: 5 }
                    ]
                },
                { 
                    id: 10, 
                    name: "ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ", 
                    priority: "ä½", 
                    currentWeek: 0, 
                    status: "æœªé–‹å§‹", 
                    examWeight: 4, 
                    description: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã€å“è³ªç®¡ç†",
                    schedule: [
                        { phase: "1é€±ç›®:ã‚¤ãƒ³ãƒ—ãƒƒãƒˆ", start: "2024-09-19", end: "2024-09-20", hours: 2 },
                        { phase: "2é€±ç›®:å¾©ç¿’", start: "2024-09-21", end: "2024-09-21", hours: 1 },
                        { phase: "3é€±ç›®:åˆå¾Œå¯¾ç­–", start: "2024-09-22", end: "2024-09-23", hours: 3 }
                    ]
                },
                { 
                    id: 11, 
                    name: "ã‚¹ãƒˆãƒ©ãƒ†ã‚¸", 
                    priority: "ä½", 
                    currentWeek: 0, 
                    status: "æœªé–‹å§‹", 
                    examWeight: 4, 
                    description: "çµŒå–¶æˆ¦ç•¥ã€ã‚·ã‚¹ãƒ†ãƒ æˆ¦ç•¥",
                    schedule: [
                        { phase: "1é€±ç›®:ã‚¤ãƒ³ãƒ—ãƒƒãƒˆ", start: "2024-09-24", end: "2024-09-25", hours: 2 },
                        { phase: "2é€±ç›®:å¾©ç¿’", start: "2024-09-26", end: "2024-09-26", hours: 1 },
                        { phase: "3é€±ç›®:åˆå¾Œå¯¾ç­–", start: "2024-09-27", end: "2024-09-28", hours: 3 }
                    ]
                }
            ]
        };

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹
        let appState = {
            subjects: [],
            studyTimes: {},
            activeTimer: null,
            timerStart: null,
            elapsedTime: 0
        };

        // ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã¨èª­ã¿è¾¼ã¿
        function saveData() {
            try {
                localStorage.setItem('studySubjects', JSON.stringify(appState.subjects));
                localStorage.setItem('studyTimes', JSON.stringify(appState.studyTimes));
                console.log('ãƒ‡ãƒ¼ã‚¿ä¿å­˜å®Œäº†');
            } catch (e) {
                console.error('ãƒ‡ãƒ¼ã‚¿ä¿å­˜å¤±æ•—:', e);
            }
        }

        function loadData() {
            try {
                const savedSubjects = localStorage.getItem('studySubjects');
                const savedTimes = localStorage.getItem('studyTimes');
                
                appState.subjects = savedSubjects ? JSON.parse(savedSubjects) : initialData.subjects;
                appState.studyTimes = savedTimes ? JSON.parse(savedTimes) : {};
                
                console.log('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†');
            } catch (e) {
                console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å¤±æ•—:', e);
                appState.subjects = initialData.subjects;
                appState.studyTimes = {};
            }
        }

        // æ—¥ä»˜é–¢é€£ã®é–¢æ•°
        function getCurrentDate() {
            return new Date();
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' });
        }

        function isCurrentTask(startDate, endDate) {
            if (!startDate || !endDate) return false;
            const today = getCurrentDate();
            const start = new Date(startDate);
            const end = new Date(endDate);
            return today >= start && today <= end;
        }

        function isOverdue(endDate) {
            if (!endDate) return false;
            const today = getCurrentDate();
            const end = new Date(endDate);
            return today > end;
        }

        // ç§‘ç›®é€²æ—æ›´æ–°
        function updateSubjectProgress(subjectId, newWeek) {
            console.log('é€²æ—æ›´æ–°:', subjectId, newWeek);
            appState.subjects = appState.subjects.map(subject => {
                if (subject.id === subjectId) {
                    return {
                        ...subject,
                        currentWeek: newWeek,
                        status: newWeek === 0 ? "æœªé–‹å§‹" : newWeek >= 3 ? "å®Œäº†" : "å­¦ç¿’ä¸­"
                    };
                }
                return subject;
            });
            saveData();
            renderApp();
        }

        // ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½
        function startTimer(taskId) {
            console.log('ã‚¿ã‚¤ãƒãƒ¼æ“ä½œ:', taskId);
            if (appState.activeTimer === taskId) {
                // åœæ­¢
                if (appState.timerStart) {
                    const elapsedMinutes = (Date.now() - appState.timerStart) / 60000;
                    appState.studyTimes[taskId] = (appState.studyTimes[taskId] || 0) + elapsedMinutes / 60;
                    saveData();
                }
                appState.activeTimer = null;
                appState.timerStart = null;
                appState.elapsedTime = 0;
            } else {
                // é–‹å§‹
                appState.activeTimer = taskId;
                appState.timerStart = Date.now();
                appState.elapsedTime = 0;
            }
            renderApp();
        }

        function formatTimeHMS(milliseconds) {
            const hours = Math.floor(milliseconds / 3600000);
            const minutes = Math.floor((milliseconds % 3600000) / 60000);
            const seconds = Math.floor((milliseconds % 60000) / 1000);
            return hours + ':' + minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0');
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportData() {
            try {
                const data = {
                    subjects: appState.subjects,
                    studyTimes: appState.studyTimes,
                    exportDate: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'å­¦ç¿’é€²æ—ãƒ‡ãƒ¼ã‚¿.json';
                a.click();
                URL.revokeObjectURL(url);
                console.log('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†');
            } catch (e) {
                console.error('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå¤±æ•—:', e);
                alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.subjects && data.studyTimes) {
                        appState.subjects = data.subjects;
                        appState.studyTimes = data.studyTimes;
                        saveData();
                        renderApp();
                        alert('ãƒ‡ãƒ¼ã‚¿ã‚’æ­£å¸¸ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸï¼');
                        console.log('ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†');
                    } else {
                        alert('ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™');
                    }
                } catch (error) {
                    console.error('ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¤±æ•—:', error);
                    alert('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            };
            reader.readAsText(file);
        }

        // ç”»é¢æç”»
        function renderApp() {
            console.log('ç”»é¢æç”»é–‹å§‹');
            
            try {
                // å…¨ä½“é€²æ—è¨ˆç®—
                const totalWeeks = appState.subjects.length * 3;
                const completedWeeks = appState.subjects.reduce((total, subject) => total + subject.currentWeek, 0);
                const overallProgress = Math.round((completedWeeks / totalWeeks) * 100);

                // é€²æ—ãƒãƒ¼æ›´æ–°
                const progressBar = document.getElementById('overall-progress');
                const progressText = document.getElementById('progress-text');
                if (progressBar) {
                    progressBar.style.width = overallProgress + '%';
                }
                if (progressText) {
                    progressText.textContent = overallProgress + '%';
                }

                // ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
                const completedCount = document.getElementById('completed-count');
                const studyingCount = document.getElementById('studying-count');
                const highPriorityCount = document.getElementById('high-priority-count');
                
                if (completedCount) {
                    completedCount.textContent = appState.subjects.filter(s => s.status === "å®Œäº†").length;
                }
                if (studyingCount) {
                    studyingCount.textContent = appState.subjects.filter(s => s.status === "å­¦ç¿’ä¸­").length;
                }
                if (highPriorityCount) {
                    highPriorityCount.textContent = appState.subjects.filter(s => s.priority === "é«˜").length;
                }

                // æ®‹ã‚Šæ—¥æ•°æ›´æ–°
                const remainingDays = document.getElementById('remaining-days');
                if (remainingDays) {
                    const today = getCurrentDate();
                    const studyEndDate = new Date('2024-10-05');
                    const diffTime = studyEndDate - today;
                    const days = Math.max(0, Math.ceil(diffTime / (1000 * 60 * 60 * 24)));
                    remainingDays.textContent = days;
                }

                // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¡¨ç¤ºã‚’å®Ÿè¡Œ
                renderScheduleTable();

                // ç§‘ç›®ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚’å®Ÿè¡Œ
                renderSubjectCards();
                
                console.log('ç”»é¢æç”»å®Œäº†');
                
            } catch (error) {
                console.error('ç”»é¢æç”»ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¡¨ç¤ºã‚’åˆ†é›¢
        function renderScheduleTable() {
            const scheduleBody = document.getElementById('schedule-body');
            if (!scheduleBody) {
                console.error('schedule-bodyè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            try {
                scheduleBody.innerHTML = '';
                console.log('ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¡¨ç¤ºé–‹å§‹');
                
                appState.subjects.forEach((subject, subjectIndex) => {
                    console.log('ç§‘ç›®å‡¦ç†ä¸­:', subject.name);
                    
                    const phases = ["ã‚¤ãƒ³ãƒ—ãƒƒãƒˆ", "å¾©ç¿’", "åˆå¾Œå¯¾ç­–"];
                    
                    for (let phaseIndex = 0; phaseIndex < phases.length; phaseIndex++) {
                        try {
                            const phase = phases[phaseIndex];
                            const taskId = subject.name + '-' + (phaseIndex + 1);
                            
                            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’å…ˆã«è¨­å®š
                            let startDate = '';
                            let endDate = '';
                            let phaseName = phase;
                            let targetHours = subject.examWeight * 0.4;
                            
                            // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æƒ…å ±ãŒã‚ã‚Œã°ä¸Šæ›¸ã
                            if (subject.schedule && Array.isArray(subject.schedule) && subject.schedule[phaseIndex]) {
                                const scheduleInfo = subject.schedule[phaseIndex];
                                if (scheduleInfo.start) startDate = scheduleInfo.start;
                                if (scheduleInfo.end) endDate = scheduleInfo.end;
                                if (scheduleInfo.phase) phaseName = scheduleInfo.phase;
                                if (scheduleInfo.hours) targetHours = scheduleInfo.hours;
                            }
                            
                            const studyTime = appState.studyTimes[taskId] || 0;
                            const remainingHours = Math.max(0, targetHours - studyTime);
                            
                            // ç¾åœ¨ã®ã‚¿ã‚¹ã‚¯ã‹ã©ã†ã‹åˆ¤å®š
                            let isCurrent = false;
                            let isOverdueTask = false;
                            
                            if (startDate && endDate) {
                                isCurrent = isCurrentTask(startDate, endDate);
                                isOverdueTask = isOverdue(endDate);
                            }
                            
                            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¤å®šã‚’ä¿®æ­£
                            let statusClass, statusText;
                            if (subject.currentWeek > phaseIndex) {
                                // æ‰‹å‹•ã§å®Œäº†ãƒãƒ¼ã‚¯ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯
                                statusClass = 'status-completed';
                                statusText = 'å®Œäº†';
                            } else if (isOverdueTask) {
                                // æœŸé™ã‚’éããŸã‚¿ã‚¹ã‚¯
                                statusClass = 'status-pending';
                                statusText = 'æœŸé™è¶…é';
                            } else if (isCurrent) {
                                // ç¾åœ¨å®Ÿè¡Œä¸­ã®ã‚¿ã‚¹ã‚¯
                                statusClass = 'status-studying';
                                statusText = 'é€²è¡Œä¸­';
                            } else {
                                // ã¾ã é–‹å§‹ã—ã¦ã„ãªã„ã‚¿ã‚¹ã‚¯
                                statusClass = 'status-pending';
                                statusText = 'æœªå®Œäº†';
                            }
                            
                            const priorityClass = 'priority-' + (subject.priority === "é«˜" ? 'high' : subject.priority === "ä¸­" ? 'medium' : 'low');
                            
                            // è¡Œä½œæˆ
                            const row = document.createElement('tr');
                            
                            // è¡Œã®èƒŒæ™¯è‰²ã‚’è¨­å®š
                            if (isCurrent) {
                                row.style.backgroundColor = '#fff3cd'; // é€²è¡Œä¸­ã¯é»„è‰²
                            } else if (isOverdueTask && subject.currentWeek <= phaseIndex) {
                                row.style.backgroundColor = '#f8d7da'; // æœŸé™è¶…éã¯èµ¤è‰²
                            } else if (subject.currentWeek > phaseIndex) {
                                row.style.backgroundColor = '#d4edda'; // å®Œäº†ã¯ç·‘è‰²
                            }
                            
                            const isTimerActive = appState.activeTimer === taskId;
                            const timerButtonClass = isTimerActive ? 'btn-danger' : 'btn-success';
                            const timerButtonText = isTimerActive ? 'åœæ­¢' : 'é–‹å§‹';
                            const timerDisplay = isTimerActive ? `<div class="timer-display">${formatTimeHMS(appState.elapsedTime)}</div>` : '';
                            
                            const dateRange = (startDate && endDate) ? `<br><small style="color: #666;">${formatDate(startDate)}ï½${formatDate(endDate)}</small>` : '';
                            
                            row.innerHTML = `
                                <td>${subject.name}</td>
                                <td>${phaseName}</td>
                                <td>
                                    <button class="btn btn-small ${timerButtonClass}" onclick="startTimer('${taskId}')">
                                        ${timerButtonText}
                                    </button>
                                    ${timerDisplay}
                                </td>
                                <td><strong style="color: #667eea;">${studyTime.toFixed(1)}h</strong></td>
                                <td><strong style="color: #dc3545;">${remainingHours.toFixed(1)}h</strong> / ${targetHours}h</td>
                                <td><span class="${priorityClass}">${subject.priority}</span></td>
                                <td>
                                    <span class="${statusClass}">${statusText}</span>
                                    ${dateRange}
                                </td>
                            `;
                            
                            scheduleBody.appendChild(row);
                            
                        } catch (rowError) {
                            console.error('è¡Œä½œæˆã‚¨ãƒ©ãƒ¼:', rowError, subject.name, phaseIndex);
                        }
                    }
                });
                
                console.log('ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¡¨ç¤ºå®Œäº†');
                
            } catch (error) {
                console.error('ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¡¨ç¤ºã‚¨ãƒ©ãƒ¼:', error);
                scheduleBody.innerHTML = '<tr><td colspan="7">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è¡¨ç¤ºã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</td></tr>';
            }
        }

        // ç§‘ç›®ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚’åˆ†é›¢
        function renderSubjectCards() {
            const subjectsGrid = document.getElementById('subjects-grid');
            if (!subjectsGrid) {
                console.error('subjects-gridè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            try {
                subjectsGrid.innerHTML = '';
                
                appState.subjects.forEach(subject => {
                    const card = document.createElement('div');
                    card.className = 'subject-card';
                    
                    const priorityClass = 'priority-' + (subject.priority === "é«˜" ? 'high' : subject.priority === "ä¸­" ? 'medium' : 'low');
                    const progressPercent = Math.round((subject.currentWeek / 3) * 100);
                    
                    card.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h3 style="margin: 0;">${subject.name}</h3>
                            <span class="${priorityClass}">${subject.priority}</span>
                        </div>
                        <p style="color: #666; font-size: 14px; margin-bottom: 10px;">${subject.description}</p>
                        <p style="font-size: 14px; margin-bottom: 10px;">é…ç‚¹: <strong>${subject.examWeight}%</strong></p>
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>é€²æ—</span>
                                <span><strong>${progressPercent}%</strong></span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercent}%"></div>
                            </div>
                        </div>
                        <div class="button-group">
                            <button class="btn btn-small ${subject.currentWeek >= 1 ? 'btn-success' : 'btn-primary'}" 
                                    onclick="updateSubjectProgress(${subject.id}, 1)">
                                ${subject.currentWeek >= 1 ? 'âœ“' : ''} å®Œäº†
                            </button>
                            <button class="btn btn-small ${subject.currentWeek >= 2 ? 'btn-success' : 'btn-primary'}" 
                                    onclick="updateSubjectProgress(${subject.id}, 2)">
                                ${subject.currentWeek >= 2 ? 'âœ“' : ''} 2é€±ç›®
                            </button>
                            <button class="btn btn-small ${subject.currentWeek >= 3 ? 'btn-success' : 'btn-primary'}" 
                                    onclick="updateSubjectProgress(${subject.id}, 3)">
                                ${subject.currentWeek >= 3 ? 'âœ“' : ''} 3é€±ç›®
                            </button>
                        </div>
                    `;
                    
                    subjectsGrid.appendChild(card);
                });
                
            } catch (error) {
                console.error('ç§‘ç›®ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚¨ãƒ©ãƒ¼:', error);
                subjectsGrid.innerHTML = '<div>ç§‘ç›®ã®è¡¨ç¤ºã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</div>';
            }
        }

        // ã‚¿ã‚¤ãƒãƒ¼æ›´æ–°
        function updateTimer() {
            if (appState.activeTimer && appState.timerStart) {
                appState.elapsedTime = Date.now() - appState.timerStart;
                renderApp();
            }
        }

        // åˆæœŸåŒ–
        function init() {
            console.log('ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–é–‹å§‹');
            
            try {
                loadData();
                console.log('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†, ç§‘ç›®æ•°:', appState.subjects.length);
                
                renderApp();
                console.log('åˆå›æç”»å®Œäº†');
                
                // ã‚¿ã‚¤ãƒãƒ¼æ›´æ–°ã‚’1ç§’ã”ã¨ã«å®Ÿè¡Œ
                setInterval(updateTimer, 1000);
                
                console.log('åˆæœŸåŒ–å®Œäº†');
            } catch (error) {
                console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                
                // ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¡¨ç¤º
                const appElement = document.getElementById('app');
                if (appElement) {
                    appElement.innerHTML = `
                        <div style="padding: 20px; background: white; margin: 20px; border-radius: 8px;">
                            <h2>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h2>
                            <p>ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚</p>
                            <button onclick="location.reload()">å†èª­ã¿è¾¼ã¿</button>
                        </div>
                    `;
                }
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«åˆæœŸåŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
